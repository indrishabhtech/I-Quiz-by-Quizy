<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C Language Quiz</title>
       <style>
        /* Basic certificate styling */
        .certificate {
            width: 70%;
            margin: 50px auto;
            border: 5px solid black;
            padding: 20px;
            text-align: center;
            font-family: 'Arial', sans-serif;
        }

        .certificate-title {
            font-size: 36px;
            font-weight: bold;
        }

        .certificate-body {
            margin-top: 20px;
            font-size: 20px;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        #quiz-container {
            width: 80%;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        button {
            padding: 10px 15px;
            margin: 10px;
            cursor: pointer;
        }

        #certificate-container {
            display: none;
            width: 80%;
            margin: 50px auto;
            padding: 20px;
            background-color: #fff;
            border: 3px solid gold;
            text-align: center;
            border-radius: 10px;
        }

        .download-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Dynamic Watermark Styling */
        .watermark {
            position: fixed;
            font-size: 24px;
            color: rgba(255, 0, 0, 0.3);
            z-index: 1000;
            pointer-events: none;
            user-select: none;
        }
            </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

    <script>

    let userName = prompt("Enter your name:");
    let userClass = prompt("Enter your class:");

    // Convert to uppercase
    function toUpperCase(str) {
        return str.toUpperCase();
    }

    userName = toUpperCase(userName);
    userClass = toUpperCase(userClass);

    // Check if the quiz has already been taken
    function checkIfQuizTaken() {
        const storedName = localStorage.getItem('user_name');
        if (storedName) {
            alert(`Hello ${storedName}, you have already taken the quiz. Check back later for new quizzes.`);
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('certificate-container').style.display = 'block';

            // Load the certificate details
            document.getElementById('user-name-cert').textContent = localStorage.getItem('user_name');
            document.getElementById('user-class-cert').textContent = localStorage.getItem('user_class');
            document.getElementById('final-score-cert').textContent = `Your Score: ${localStorage.getItem('user_score')} / ${quizData.length}`;
            document.getElementById('current-date-cert').textContent = `Date: ${localStorage.getItem('user_date')}`;
        }
    }

    // Function to add and update dynamic watermark
    function addWatermark() {
        const watermarkElement = document.getElementById('watermark');

        // Randomize position of watermark
        const randomX = Math.floor(Math.random() * (window.innerWidth - 100)) + 'px';
        const randomY = Math.floor(Math.random() * (window.innerHeight - 50)) + 'px';

        // Update watermark content and position
        const timestamp = new Date().toLocaleTimeString();
        watermarkElement.textContent = `${userName} - Hello @ ${timestamp}`;
        watermarkElement.style.left = randomX;
        watermarkElement.style.top = randomY;
    }

    // Call the watermark function when the page loads
    window.onload = function() {
        addWatermark();
        setInterval(addWatermark, 10000);  // Update watermark every 10 seconds
    };

    let tabSwitchCount = 0;
    const maxTabSwitchesAllowed = 2; // set the max number of allowed tab switches

    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            tabSwitchCount++;
            alert("You switched tabs! Don't cheat! Warning " + tabSwitchCount + "/" + maxTabSwitchesAllowed);

            // Optionally, end the quiz after the defined number of tab switches
            if (tabSwitchCount >= maxTabSwitchesAllowed) {
                endQuiz();
            }
        }
    });

    // Function to end the quiz if the user switches tabs too many times
    function endQuiz() {
        alert("You have been disqualified for switching tabs too many times.");
        document.getElementById('quiz-container').style.display = 'none';
    }

    // Prevent navigation away from the quiz page (Restrict Navigation)
    window.onbeforeunload = function () {
        return "Are you sure you want to leave? Your progress will be lost!";
    };

    // Quiz data
    const quizData = [
        {
            question: "What is the output of the following code?\n\n int main() {\n    int a = 5, b = 10;\n    printf(\"%d\", a++ + ++b);\n    return 0;\n }",
            options: ["16", "17", "15", "11"],
            correctAnswer: "16"
        },
        {
            question: "What is the purpose of the 'volatile' keyword in C?",
            options: [
                "Optimize variable usage",
                "Prevent optimization of variables",
                "Access global variables",
                "Force inlining of functions"
            ],
            correctAnswer: "Prevent optimization of variables"
        }
        // Add more questions as needed
    ];

    let currentQuestion = 0;
    let score = 0;
    let totalSecondsRemaining = 1200;
    let secondsRemaining = 30;
    let totalQuizTimer;
    let questionTimer;

    function startQuiz() {
        startTotalTimer();
        showQuestion();
    }

    function startTotalTimer() {
        totalQuizTimer = setInterval(updateTotalTimer, 1000);
    }

    function updateTotalTimer() {
        const totalTimerElement = document.getElementById('total-timer');
        if (totalSecondsRemaining > 0) {
            totalSecondsRemaining--;
            const minutes = Math.floor(totalSecondsRemaining / 60);
            const seconds = totalSecondsRemaining % 60;
            totalTimerElement.textContent = `Total Time Remaining: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        } else {
            clearInterval(totalQuizTimer);
            totalTimerElement.textContent = 'Total Time Expired!';
            endQuiz();
        }
    }

    function startQuestionTimer() {
        questionTimer = setInterval(updateQuestionTimer, 1000);
    }

    function updateQuestionTimer() {
        const questionTimerElement = document.getElementById('question-timer');
        if (secondsRemaining > 0) {
            secondsRemaining--;
            questionTimerElement.textContent = `Time Remaining: ${secondsRemaining} seconds`;
        } else {
            clearInterval(questionTimer);
            nextQuestion();
        }
    }

    function showQuestion() {
        const questionData = quizData[currentQuestion];
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        questionElement.textContent = questionData.question;

        // Clear previous options
        optionsElement.innerHTML = '';
        questionData.options.forEach((option, index) => {
            const optionButton = document.createElement('button');
            optionButton.textContent = option;
            optionButton.onclick = function () {
                checkAnswer(option);
            };
            optionsElement.appendChild(optionButton);
        });

        secondsRemaining = 30;
        startQuestionTimer();
    }

    function checkAnswer(selectedOption) {
        const correctAnswer = quizData[currentQuestion].correctAnswer;
        if (selectedOption === correctAnswer) {
            score++;
        }
        nextQuestion();
    }

    function nextQuestion() {
        clearInterval(questionTimer);
        currentQuestion++;
        if (currentQuestion < quizData.length) {
            showQuestion();
        } else {
            endQuiz();
        }
    }

    function endQuiz() {
        clearInterval(totalQuizTimer);
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('certificate-container').style.display = 'block';
        document.getElementById('final-score').textContent = `Your Score: ${score} / ${quizData.length}`;

        // Save quiz completion in localStorage
        localStorage.setItem('quiz_taken', 'true');
        localStorage.setItem('user_name', userName);
        localStorage.setItem('user_class', userClass);
        localStorage.setItem('user_score', score);
        localStorage.setItem('user_date', new Date().toLocaleDateString());

        // Show the saved certificate details
        document.getElementById('user-name-cert').textContent = userName;
        document.getElementById('user-class-cert').textContent = userClass;
        document.getElementById('final-score-cert').textContent = `Your Score: ${score} / ${quizData.length}`;
        document.getElementById('current-date-cert').textContent = `Date: ${new Date().toLocaleDateString()}`;
    }

    </script>
</head>
<body onload="checkIfQuizTaken();">

    <div id="watermark" class="watermark"></div>

    <div id="quiz-container">
        <div id="total-timer">Total Time Remaining: 20:00</div>
        <div id="question-timer">Time Remaining: 30 seconds</div>
        <div id="question"></div>
        <div id="options"></div>
        <button onclick="startQuiz()">Start Quiz</button>
    </div>

    <div id="certificate-container" style="display: none;">
        <h1>Certificate of Completion</h1>
        <p id="user-name-cert"></p>
        <p id="user-class-cert"></p>
        <p id="final-score-cert"></p>
        <p id="current-date-cert"></p>
        <button class="download-btn" onclick="downloadCertificate()">Download Certificate</button>
    </div>

    <script>
    function downloadCertificate() {
        var certificateElement = document.getElementById('certificate-container');
        html2pdf()
            .from(certificateElement)
            .save('certificate.pdf');
    }
    </script>
</body>
</html>
